<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinema : Liste de films et séries</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/riot/9.1.4/riot+compiler.min.js"></script>
    

    <script type="riot" src="ModalComponent.riot"></script>
    <script type="riot" src="NavbarComponent.riot"></script>
    <script type="riot" src="HeaderComponent.riot"></script>
    <script type="riot" src="footer-component.riot"></script>
    
    <script>
            riot.compile().then(() => {
                riot.mount('modal-component');
                riot.mount('navbar-component');
                riot.mount('header-component');
                riot.mount('footer-component');
            });
        ;
    </script>

</head>
<body>

   <navbar-component></navbar-component>
   <header-component></header-component>
   <modal-component></modal-component>

    <div class="columns" style="margin-top: 20px;">
        <aside class="column is-2">
            <aside class="menu menu-sticky">
            </aside>
            <aside class="menu menu-sticky">
                <p class="menu-label">Filtre</p>
                <div class="select is-rounded">
                    <select id="filterSelect">
                        <option value="trending">Tendance</option>
                        <option value="top_rated">Mieux notés</option>
                    </select>
                </div>
            
                <p class="menu-label" style="margin-top: 20px;">Genres</p>
                <div class="buttons" id="genreButtons">
                    <div class="buttons" id="genreButtons">
</div>

                </div>
            </aside>
            
        </aside>     
        

                
                <div id="movies" class="columns is-multiline">
                    <!-- Les films vont ici -->
                </div>
            </div>
        </main>
    </div>

    <div class="section">
        <nav class="pagination is-centered" role="navigation" aria-label="pagination">
            <a class="pagination-previous" disabled>Précédent</a>
            <a class="pagination-next">Suivant</a>
            <ul class="pagination-list">
                <li><a class="pagination-link" aria-label="Goto page 1">1</a></li>
                <li><span class="pagination-ellipsis">&hellip;</span></li>
                <li><a class="pagination-link" aria-label="Goto page 45">45</a></li>
                <li><a class="pagination-link is-current" aria-label="Page 46" aria-current="page">46</a></li>
                <li><a class="pagination-link" aria-label="Goto page 47">47</a></li>
                <li><span class="pagination-ellipsis">&hellip;</span></li>
                <li><a class="pagination-link" aria-label="Goto page 86">86</a></li>
            </ul>
        </nav>
    </div>
    <footer-component></footer-component>
    <script>
        const apiKey = '34c6494d54853100f99d5fdf6bde3dd7';
        const apiUrlTrending = `https://api.themoviedb.org/3/trending/movie/week?api_key=${apiKey}&language=fr-FR`;
        const apiUrlGenres = `https://api.themoviedb.org/3/genre/movie/list?api_key=${apiKey}&language=fr-FR`;
        
        let genres = {};
        
        // Charger les genres
        fetch(apiUrlGenres)
            .then(response => response.json())
            .then(data => {
                data.genres.forEach(genre => {
                    genres[genre.id] = genre.name;
                });
                loadMovies();
            })
            .catch(error => console.error('Erreur lors de la récupération des genres:', error));
        
        function loadMovies() {
            fetch(apiUrlTrending)
                .then(response => response.json())
                .then(data => {
                    const moviesContainer = document.getElementById('movies');
                    moviesContainer.innerHTML = ''; // Vide le conteneur si nécessaire
                    data.results.forEach(movie => {
                        const movieEl = document.createElement('div');
                        movieEl.classList.add('column', 'is-3');
                        const movieGenres = movie.genre_ids.map(id => genres[id]).join(', ');
                        const stars = convertScoreToStars(movie.vote_average);
                        movieEl.innerHTML = `
                            <div class="card" style="cursor: pointer;">
                                <div class="card-image">
                                    <figure class="image is-4by3">
                                        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}" title="${movie.title}">
                                    </figure>
                                </div>
                                <div class="card-content">
                                    <p class="title is-4">${movie.title}</p>
                                    <p class="subtitle is-6">${movie.release_date}</p>
                                    <div class="stars">${stars}</div>
                                    <div class="tags">${movieGenres}</div>
                                </div>
                            </div>
                        `;
                        movieEl.addEventListener('click', () => {
                            openModal(movie);
                        });
                        moviesContainer.appendChild(movieEl);
                    });
                })
                .catch(error => console.error('Erreur lors de la récupération des films:', error));
        }
        
        function openModal(movie) {
            document.getElementById('modalMovieTitle').textContent = movie.title;
            document.getElementById('modalMoviePoster').src = `https://image.tmdb.org/t/p/w500${movie.poster_path}`;
            document.getElementById('modalMovieDescription').textContent = movie.overview; // Assurez-vous que 'overview' contient la description du film
            document.getElementById('movieModal').classList.add('is-active');
        }
        
        function closeModal() {
            document.getElementById('movieModal').classList.remove('is-active');
        }
        
        function convertScoreToStars(score) {
            const roundedScore = Math.round(score / 2);
            let stars = '';
            for (let i = 0; i < 5; i++) {
                if (i < roundedScore) {
                    stars += `<i class="fas fa-star"></i>`;
                } else {
                    stars += `<i class="far fa-star"></i>`;
                }
            }
            return stars;
        }


        function searchMovies() {
    const searchQuery = document.getElementById('searchInput').value.trim();
    if (!searchQuery) {
        loadMovies(); // Recharge les films en tendance si la barre de recherche est vide
        return;
    }
    const searchUrl = `https://api.themoviedb.org/3/search/movie?api_key=${apiKey}&query=${encodeURIComponent(searchQuery)}&language=fr-FR`;

    fetch(searchUrl)
        .then(response => response.json())
        .then(data => {
            const moviesContainer = document.getElementById('movies');
            moviesContainer.innerHTML = ''; // Vide le conteneur pour les nouveaux résultats
            if (data.results.length === 0) {
                moviesContainer.innerHTML = '<p class="has-text-centered">Aucun film trouvé.</p>';
                return;
            }
            displayMovies(data.results); // Affiche les résultats de la recherche
        })
        .catch(error => {
            console.error('Erreur lors de la recherche:', error);
            const moviesContainer = document.getElementById('movies');
            moviesContainer.innerHTML = '<p class="has-text-centered">Erreur lors de la recherche des films.</p>';
        });
}

document.addEventListener('DOMContentLoaded', (event) => {
    // Assurez-vous que le DOM est complètement chargé
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
        // Vérifie si la touche pressée est 'Entrée'
        if (e.key === 'Enter') {
            e.preventDefault(); // Empêche l'action par défaut
            searchMovies(); // Appelle la fonction de recherche
        }
    });
});


// Exemple de la fonction displayMovies
function displayMovies(movies) {
    const moviesContainer = document.getElementById('movies');
    movies.forEach(movie => {
        const movieEl = document.createElement('div');
        movieEl.classList.add('column', 'is-3');
        const movieGenres = movie.genre_ids.map(id => genres[id] ? genres[id] : 'Genre inconnu').join(', ');
        const stars = convertScoreToStars(movie.vote_average);
        movieEl.innerHTML = `
            <div class="card" onclick="openModal(${JSON.stringify(movie).split('"').join("&quot;")})" style="cursor: pointer;">
                <div class="card-image">
                    <figure class="image is-4by3">
                        <img src="https://image.tmdb.org/t/p/w500${movie.poster_path}" alt="${movie.title}" title="${movie.title}">
                    </figure>
                </div>
                <div class="card-content">
                    <p class="title is-4">${movie.title}</p>
                    <p class="subtitle is-6">${movie.release_date}</p>
                    <div class="stars">${stars}</div>
                    <div class="tags">${movieGenres}</div>
                </div>
            </div>
        `;
        moviesContainer.appendChild(movieEl);
    });
}

function convertScoreToStars(score) {
    const roundedScore = Math.round(score / 2);
    let stars = '';
    for (let i = 0; i < 5; i++) {
        stars += i < roundedScore ? `<i class="fas fa-star"></i>` : `<i class="far fa-star"></i>`;
    }
    return stars;
}


// Supposons que vous ayez déjà récupéré les genres dans un objet `genres`
function setupGenreButtons() {
    const container = document.getElementById('genreButtons');
    Object.keys(genres).forEach(genreId => {
        const button = document.createElement('button');
        button.classList.add('button', 'is-small', 'is-info', 'is-light');
        button.innerText = genres[genreId];
        button.onclick = () => { 
            // Logique pour filtrer les films par ce genre
            // Peut-être marquer le bouton comme sélectionné ici
        };
        container.appendChild(button);
    });
}


    // JavaScript pour gérer le marquee
    const marqueeText = "Le meilleur site pour les cinéphiles, constamment mis à jour rien que pour vous.";
    const marqueeContainer = document.querySelector('.marquee');
    const marqueeContent = document.createElement('div');
    marqueeContent.classList.add('marquee-content');
    marqueeContent.textContent = marqueeText; // Initialiser le texte du marquee
    marqueeContainer.appendChild(marqueeContent);

    let marqueeSpeed = 2; // Vitesse du défilement, ajustez selon besoin
    let marqueePosition = marqueeContainer.offsetWidth; // Départ du côté droit

    function updateMarquee() {
        marqueePosition -= marqueeSpeed; // Déplace le marquee vers la gauche
        if (marqueePosition < -marqueeContent.offsetWidth) {
            marqueePosition = marqueeContainer.offsetWidth; // Reprend au bord droit après avoir atteint le bord gauche
        }
        marqueeContent.style.transform = `translateX(${marqueePosition}px)`;
        requestAnimationFrame(updateMarquee); // Animation continue
    }

    updateMarquee(); // Lance l'animation du marquee

    fetch(apiUrlGenres)
    .then(response => response.json())
    .then(data => {
        genres = data.genres.reduce((acc, genre) => {
            acc[genre.id] = genre.name;
            return acc;
        }, {});
        
        // Met à jour l'UI avec les genres disponibles après le fetching
        setupGenreButtons(genres);
    })
    .catch(error => console.error('Erreur lors de la récupération des genres:', error));

// Fonction pour générer dynamiquement les boutons des genres
function setupGenreButtons(genres) {
    const container = document.getElementById('genreButtons');
    container.innerHTML = ''; // Nettoie les boutons précédents

    // Crée un bouton pour chaque genre
    Object.entries(genres).forEach(([genreId, genreName]) => {
        const button = document.createElement('button');
        button.classList.add('button', 'is-small', 'is-info', 'is-light');
        button.innerText = genreName;
        button.onclick = () => filterGenre(genreId); // Assigne une fonction de filtrage basée sur l'ID du genre
        container.appendChild(button);
    });
}

// Exemple de fonction pour filtrer les films par genre (à compléter selon la logique de filtrage)
function filterGenre(genreId) {
    console.log(`Filtrage des films pour le genre: ${genres[genreId]}`);
    // Ici, ajoutez la logique pour filtrer les films et mettre à jour l'UI en conséquence
}
   
</script>
        
</body>
</html>
